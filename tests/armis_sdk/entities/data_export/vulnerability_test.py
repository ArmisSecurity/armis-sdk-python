import collections
import datetime

import pandas

from armis_sdk.entities.data_export.vulnerability import Vulnerability

VulnerabilityNT = collections.namedtuple(
    "VulnerabilityNT",

    [
        "device_id", "vulnerability_cve_uid", "vulnerability_advisory_id", "vulnerability_remediation_types",
        "avm_rating", "match_source", "status", "status_change_time", "status_change_reason",
    ],
)


def test_series_to_model():
    application_nt = pandas.Series(
        {
            "device_id": 1,
            "vulnerability_cve_uid": "CVE-123",
            "vulnerability_advisory_id": "KB123",
            "vulnerability_remediation_types": ["type1", "N/A", "type2"],
            "avm_rating": "GOOD",
            "match_source": ["source1", "N/A", "source2"],
            "status": "OPEN",
            "status_change_time": pandas.Timestamp.fromisoformat("2025-11-01"),
            "status_change_reason": "Good reason",
        },
    )

    assert Vulnerability.series_to_model(application_nt) == Vulnerability(
        device_id=1,
        cve_uid="CVE-123",
        advisory_id="KB123",
        remediation_types=["type1", "type2"],
        avm_rating="GOOD",
        match_source=["source1", "source2"],
        status="OPEN",
        status_change_time=datetime.datetime(2025, 11, 1),
        status_change_reason="Good reason",
    )
